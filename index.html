<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Claim FAIR Tokens - FairBase</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0052FF, #66B2FF);
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
      text-align: center;
    }

    h1 {
      font-size: 3rem;
      margin-bottom: 0.5rem;
    }

    h2 {
      font-weight: 400;
      font-size: 1.2rem;
      margin-top: 0;
      color: #d0e9ff;
      max-width: 600px;
    }

    button {
      background-color: #0052FF;
      border: none;
      color: white;
      padding: 15px 30px;
      font-size: 1.2rem;
      border-radius: 12px;
      cursor: pointer;
      margin-top: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      transition: background 0.3s;
    }

    button:hover {
      background-color: #0040cc;
    }

    #status {
      margin-top: 15px;
      font-size: 1.1rem;
      color: #ffd700;
    }

    #walletAddress {
      margin-top: 10px;
      font-size: 1rem;
      color: #bbf1ff;
    }

    #countdown {
      font-size: 1.5rem;
      margin-top: 15px;
      color: #ffffff;
    }
  </style>
</head>
<body>
  <h1>Claim Your 1M FAIR Tokens</h1>
  <h2>FairBase is a fair and transparent token pre-sale on Base. Every wallet can purchase 1M FAIR tokens for 0.004 ETH. This is a one-time opportunity per wallet — no bots, no whales, just fairness.</h2>
  <button id="connectBtn" onclick="connectWallet()">Connect Wallet</button>
  <div id="walletAddress"></div>
  <button onclick="claimTokens()">Pay 0.004 ETH & Claim 1M FAIR</button>
  <div id="countdown"></div>
  <div id="status"></div>

  <script>
    const claimContractAddress = "0xd5f8e55443effded888bfc5543d5169ca52ff822";
    const tokenAddress = "0xdc3e3fa829354d84f0963020a593542bab7c6b2b";

    const claimAbi = [
      "function claim() external payable",
      "function claimed(address) view returns (bool)",
      "function deadline() view returns (uint256)"
    ];

    let provider;
    let signer;
    let contract;

    async function connectWallet() {
      if (window.ethereum) {
        try {
          await window.ethereum.request({ method: "eth_requestAccounts" });
          provider = new ethers.providers.Web3Provider(window.ethereum);
          signer = provider.getSigner();
          contract = new ethers.Contract(claimContractAddress, claimAbi, signer);
          const address = await signer.getAddress();
          document.getElementById("status").innerText = "Wallet connected";
          document.getElementById("walletAddress").innerText = address;
          document.getElementById("connectBtn").innerText = "Wallet Connected";
          await updateChart();
        } catch (err) {
          document.getElementById("status").innerText = "Connection failed";
        }
      } else {
        document.getElementById("status").innerText = "MetaMask not detected";
      }
    }

    async function claimTokens() {
      if (!contract) {
        document.getElementById("status").innerText = "Please connect your wallet first.";
        return;
      }

      try {
        const address = await signer.getAddress();
        const hasClaimed = await contract.claimed(address);
        if (hasClaimed) {
          document.getElementById("status").innerText = "You have already claimed your FAIR tokens.";
          return;
        }

        const deadline = await contract.deadline();
        const now = Math.floor(Date.now() / 1000);
        if (now > deadline) {
          document.getElementById("status").innerText = "Claim period has ended.";
          return;
        }

        const tx = await contract.claim({ value: ethers.utils.parseEther("0.004") });
        document.getElementById("status").innerText = "Claiming...";
        await tx.wait();
        document.getElementById("status").innerText = "Success! 1M FAIR tokens claimed.";
      } catch (error) {
        console.error(error);
        document.getElementById("status").innerText = "Transaction failed.";
      }
    }

    const deadlineUnix = Math.floor(Date.now() / 1000) + (10 * 24 * 60 * 60);

    function updateCountdown() {
      const now = Math.floor(Date.now() / 1000);
      let remaining = deadlineUnix - now;
      if (remaining <= 0) {
        document.getElementById("countdown").innerText = "⏳ Claim period has ended.";
        return;
      }

      const days = Math.floor(remaining / (60 * 60 * 24));
      remaining %= 60 * 60 * 24;
      const hours = Math.floor(remaining / (60 * 60));
      remaining %= 60 * 60;
      const minutes = Math.floor(remaining / 60);
      const seconds = remaining % 60;

      document.getElementById("countdown").innerText = `⏳ Ends in ${days}d ${hours}h ${minutes}m ${seconds}s`;
    }

    setInterval(updateCountdown, 1000);
  </script>
  <div style="margin-top: 40px; font-size: 0.9rem;">
    Follow us on
    <a href="https://x.com/yourusername" target="_blank" style="color: #ffd700; text-decoration: underline;">X (Twitter)</a>
  </div>
  <canvas id="claimChart" width="300" height="150" style="margin-top: 40px;"></canvas>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Dummy value, replace with actual claimed amount if reading from contract
    let totalClaimed = 0;

    async function updateChart() {
      try {
        const balance = await provider.getBalance(claimContractAddress);
        const ethReceived = parseFloat(ethers.utils.formatEther(balance));
        totalClaimed = Math.floor((ethReceived / 0.004));
      } catch (e) {
        totalClaimed = 0;
      }

      const data = {
        labels: ['Claimed', 'Remaining'],
        datasets: [{
          label: 'Token Claims',
          data: [totalClaimed, 900 - totalClaimed],
          backgroundColor: ['#FFD700', '#003366'],
        }]
      };

      new Chart(
        document.getElementById('claimChart'),
        {
          type: 'doughnut',
          data: data,
          options: {
            plugins: {
              legend: {
                labels: {
                  color: 'white'
                }
              }
            }
          }
        }
      );
    }

    // window.addEventListener('load', updateChart);
  </script>
</body>
</html>
